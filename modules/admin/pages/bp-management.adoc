= Настройка СУБП

Индивидуальная настройка каждого сервиса WorkFlow производится в конфигурационном файле модуля. Информацию о работе с журналом см. в разделе "xref:log.adoc[]".

Журнал находится по адресу, указанному в конфигурационном файле модуля `/usr/lib/docsvision/workflow/appsettings.json`, в параметре `menu:DocsVision[Workflow > WorkflowServer]`.

.Фрагмент файла `appsettings.json`:
[source,json]
----
  "DocsVision": {
    "Workflow": {
      "WorkflowServer": {
        "LogFile": "путь_к_файлу.log", <.>
        "TraceLevel": 4, <.>
        "LogFileDateTemplate": "u" <.>
      }
    }
}
----
<.> Путь до файла журнала.
<.> Уровень журналирования:
* `Off` = `0`,
* `Error` = `1`,
* `Warning` = `2`,
* `Info` = `3`,
* `Verbose` = `4`
<.> Формат даты штампа времени в имени файла журнала. Форматы можно комбинировать, с подробной информацией можно ознакомиться https://metanit.com/sharp/tutorial/19.2.php[в интернете].

// диалоговом окне *WorkflowService*.
//
// .Окно настройки сервиса Workflow
// image::wf-settings.png[Окно настройки сервиса Workflow]
//\
// .Чтобы выполнить настройку, выполните следующие действия:
// . Откройте _{cns}_, перейдите в раздел menu:Модули расширения[{wf}].
// . Выделите в списке сервис, параметры которого подлежат настройке, и нажмите кнопку *Изменить*.
// . В секции _Настройки сервиса_ укажите:
// +
// * _Имя службы_ -- укажите название службы. По умолчанию: _{dv} 5.5 Workflow Server_.
// * _Тип запуска_ определяет способ активизации службы.
// +
// .Доступные варианты:
// ** Автоматический -- при запуске компьютера.
// ** Ручной -- вручную в любой момент времени.
// ** Отключен -- служба отключена.
// +
// * _Учетная запись_, под которой будет работать сервер бизнес-процессов. Эта учетная запись должна входить в группы пользователей *{dv-power-users-serv}* и *{dv-wf-creators-serv}* на сервере {dv}, а также иметь доступ к профилю для работы с Microsoft Exchange Server (следующая группа настроек). +
// Каждому сервису может соответствовать только одна учётная запись.
// +
// * _Пароль_ -- пароль учетной записи службы управления процессами.
// +
// Настройки этой группы параметров доступны как из _Консоли настройки {dv}_, так и в списке сервисов в главном меню Windows menu:Пуск[Настройки > Панель управления > Администрирование > Сервисы].
// +
// [NOTE]
// ====
// Изменение учетной записи, под которой работает сервер бизнес-процессов, следует производить только из _Консоли настройки {dv}_. Изменение учетной записи в окне _Сервисы_ управления компьютером приведет к противоречивости настроек и может стать причиной сбоя в работе системы.
// ====
// +
// . В секции _Параметры восстановления_ укажите параметры перезапуска сервера управления процессами в случае некорректной работы, а именно:
// +
// * Установите флаг `*Перезапускать службу при первом неудачном старте*`.
// * В поле _Задержка перед перезапуском <...> сек_ укажите время в секундах.
// * В поле _Очищать счетчик попыток через <...> сек_ укажите время в секундах.
// +
// . Группа параметров _Параметры управления_ описывает периодичность работы сервера управления процессами:
// +
// * _Период поиска процессов (сек)_ -- пауза между проведением Workflow поиска новых активных процессов.
// * _Максимальный объем памяти (Мб)_ представляет собой объем _физической_ памяти, выделенной серверу управления процессами. По умолчанию значение параметра равно `512` Мб. При изменении параметра следует принять во внимание следующие ограничения:
// ** В редакциях {dv} x86 значение параметра можно устанавливать любым, однако процесс `ExecLogic.exe` в любом случае не сможет задействовать более `1,75` Гб оперативной памяти и при превышении этого значения примет решение о перезагрузке.
// ** В редакциях {dv} x64 значение параметра можно устанавливать любым, в зависимости от объёма доступной физической памяти. При этом процесс `ExecLogic32.exe` в любом случае не сможет задействовать более `1,75` Гб оперативной памяти и при превышении этого значения примет решение о перезагрузке. Процесс `ExecLogic.exe` сможет задействовать весь выделенный ему объём оперативной памяти.
// * _Предел таймаутов функций_ -- максимально допустимое число таймаутов. Если разрешенный лимит превышен, то рабочий процесс (`ExecLogic`) примет решение о перезагрузке, а процессы с превышенным временем обработки будут передвинуты в конец очереди ожидающих обработки процессов.
// * _Время ожидания выполнения функции в потоке (сек)_ -- период, за который должна выполниться функция. Этот период используется, если в настройках функции в поле _Период опроса_ не указан другой интервал.
// * _Число процессов в пакете_ -- максимальное количество параллельно обрабатываемых бизнес-процессов.
// * _Размер пула шлюза_, где пул шлюзов -- это совокупность параллельно работающих экземпляров шлюзов одного типа с одинаковыми настройками, выделяемых для обработки процессов.
// * _Размер пула сессий_, где пул сессий -- это совокупность параллельно работающих сессий с одинаковыми настройками подключения, выделяемых для обработки процессов.
// * _Время ожидания выполнения метода Storage Server (сек)_ -- период ожидания ответа сервера, после которого возвращается сообщение об ошибке `Сервер недоступен`.
// * Если установлен флаг `*Режим изоляции процесса*`, каждому обрабатываемому процессу будет выделяться личная сессия и личный набор шлюзов, которые на время обработки процесса будут находиться в его эксклюзивном использовании. Режим необходим для того, чтобы задержки и блокировки, возникающие в сессии/шлюзе из-за использования их неким процессом, по возможности (зависит от реализации шлюза) не влияли на другой процесс.
// +
// [NOTE]
// ====
// Используемые по умолчанию настройки сервиса WorkFlow оптимальны для большинства случаев. Менять их рекомендуется только после консультации со службами технической поддержки или консалтинга _{dv}_.
// ====
// +
// . В секции _Прочие параметры_ укажите дополнительные настройки сервера управления процессами:
// +
// * _Порт для удаленных вызовов_ содержит значение порта для удаленного доступа к серверу. Поле получает значение по умолчанию при инсталляции системы (хотя и доступно для изменения).
// * В поле _Имя файла журнала_ можно указать путь к файлу, в котором будут фиксироваться все события, происходящие на сервере управления процессами. +
// При корректной работе сервера ведение журнала не обязательно, однако в случае его нестабильной работы журнал может помочь выяснить неполадки и устранить их. Для ведения журнала у учетной записи сервиса Workflow должны быть права на папку, в которой Создаётся журнал.
// +
// [NOTE]
// ====
// Журнал является средством диагностики при возникновении нештатных ситуаций и предназначен для передачи в службу технической поддержки. Анализ содержимого журнала пользователем или администратором не предполагается. Кроме этого журнала служба технической поддержки может запросить другие данные, которые могут оказаться полезными при анализе нештатных ситуаций.
// ====
// +
// * Если предполагается вести журнал, то в поле _Уровень журналирования_ следует указать глубину фиксации процессов:
// +
// --
// ** *_Выключено_*.
// ** *_Ошибки_*.
// ** *_Предупреждения_*.
// ** *_Информация_*.
// ** *_Отладочные сообщения_*.
// --
// +
// Каждый последующий уровень журналирования включает в себя сообщения предыдущих уровней. Таким образом, включение режима `*Отладочные сообщения*` будет означать так же фиксацию сообщений об ошибках, предупреждениях и информационных сообщениях.
// +
// [NOTE]
// ====
// Если выбран уровень журналирования с высокой детализацией, то за небольшой промежуток времени размер журнала может существенно увеличиться. Таким образом, устанавливать уровень журналирования `*Отладочные сообщения*` рекомендуется только при возникновении проблем в работе подсистемы Workflow или по просьбе технической поддержки {dv}.
// ====
// +
// * В поле _Формат даты в имени журнала_ задается шаблон (маска) для вывода даты файла журнала в его имени. По умолчанию используется маска `yyMMdd`, она может быть изменена на другую, соответствующую стандарту ISO 8601.
// +
// Если формат даты задан, то в `0:00` вывод сообщений перенаправляется в новый файл журнала, имя которого образуется как `ИмяДоПервойТочкиОтформатированнаяДата.ИмяПослеПервойТочки`. Если рассматриваемое поле очищено, журнал сервиса продолжает вестись в прежнем файле. Указанный в поле формат даты автоматически заносится в реестр в параметр `LogFileDateTemplate`.
// +
// * Кнопка *Сбросить счетчики* обнуляет содержимое счетчиков объекта {dv} WorkFlow в Performance Monitor.
// +
// . В состав последней секции входят кнопки управления сервисом: *Запустить*, *Перезапустить* и *Остановить*.
// . Нажмите кнопку *ОК* (форма будет закрыта) или *Применить* для применения настроек. Сервис WorkFlow будет перезапущен с новыми настройками.
